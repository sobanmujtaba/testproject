<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CGPA Calculator</title>
    <style>
        :root {
            /* Light Purplish / Lavender Palette */
            --primary: #8b5cf6; /* Violet-500 */
            --primary-hover: #7c3aed; /* Violet-600 */
            --primary-soft: #f5f3ff; /* Violet-50 */
            --bg-gradient: linear-gradient(135deg, #f5f3ff 0%, #ede9fe 100%);
            --card-bg: rgba(255, 255, 255, 0.95);
            --text: #4c1d95; /* Violet-900 */
            --text-muted: #6b7280;
            --border: #ddd6fe; /* Violet-200 */
            --danger: #ef4444;
        }

        body {
            font-family: "Segoe UI", "Roboto", "Helvetica Neue", sans-serif;
            background: var(--bg-gradient);
            color: var(--text);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        .container { 
            width: 100%; 
            max-width: 950px; 
            margin-bottom: 40px;
        }

        .header-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            background: white;
            padding: 20px 30px;
            border-radius: 20px;
            box-shadow: 0 10px 25px -5px rgba(139, 92, 246, 0.15);
            border: 1px solid white;
        }

        h1 { 
            margin: 0; 
            font-size: 1.8rem; 
            color: var(--primary); 
            font-weight: 700;
            letter-spacing: -0.5px;
        }

        /* Semester Card */
        .semester-card {
            background: var(--card-bg);
            border-radius: 16px;
            box-shadow: 0 4px 6px -1px rgba(139, 92, 246, 0.05);
            margin-bottom: 25px;
            border: 1px solid white;
            overflow: hidden;
            transition: transform 0.2s ease;
        }
        
        .semester-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(139, 92, 246, 0.1);
        }

        .semester-header {
            background: var(--primary-soft);
            padding: 15px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border);
        }

        .semester-title {
            font-weight: 700;
            color: #5b21b6; /* Deep Violet */
            font-size: 1.1rem;
            border: none;
            background: transparent;
            width: 200px;
        }

        /* Table */
        .table-wrapper { padding: 0 25px; overflow-x: auto; }
        
        table { width: 100%; border-collapse: separate; border-spacing: 0 8px; margin-top: 5px; }
        
        th {
            text-align: left;
            padding: 10px 8px;
            font-size: 0.75rem;
            color: #7c3aed;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 700;
        }

        td { padding: 8px; vertical-align: middle; }
        
        tr td:first-child { border-radius: 8px 0 0 8px; }
        tr td:last-child { border-radius: 0 8px 8px 0; }
        tbody tr:hover { background-color: #f5f3ff; }

        /* Inputs */
        input[type="text"], input[type="number"], select {
            width: 100%;
            padding: 10px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            font-size: 0.95rem;
            background: #fff;
            color: var(--text-muted);
            transition: all 0.2s;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
            color: var(--text);
        }

        /* Checkbox Style */
        .checkbox-wrapper {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            font-size: 0.8rem;
            color: #7c3aed;
            font-weight: 600;
            cursor: pointer;
            background: #ede9fe;
            padding: 5px 10px;
            border-radius: 20px;
        }
        .checkbox-wrapper input { width: auto; margin: 0; cursor: pointer; }

        /* Footer Results */
        .semester-footer {
            background: white;
            padding: 20px 25px;
            border-top: 1px solid #f3f4f6;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .result-box { 
            padding: 15px; 
            border-radius: 12px; 
            position: relative; 
            text-align: center;
        }
        
        .result-sem { background: #f8fafc; color: #64748b; }
        .result-cum { background: #ede9fe; color: #5b21b6; border: 1px solid #ddd6fe; }
        
        .label { font-size: 0.7rem; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 5px; opacity: 0.8; }
        .main-value { font-size: 2rem; font-weight: 800; line-height: 1; }
        .sub-details { font-size: 0.8rem; margin-top: 8px; opacity: 0.8; }

        /* Buttons */
        .btn { padding: 10px 20px; border-radius: 8px; border: none; cursor: pointer; font-weight: 600; transition: 0.2s; }
        .btn-primary { 
            background: var(--primary); 
            color: white; 
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
        }
        .btn-primary:hover { 
            background: var(--primary-hover); 
            transform: translateY(-1px); 
            box-shadow: 0 6px 15px rgba(139, 92, 246, 0.4); 
        }
        
        .btn-row { background: white; border: 1px solid #e2e8f0; color: #64748b; font-size: 0.85rem; margin: 10px 0 20px; }
        .btn-row:hover { background: #f8fafc; border-color: #c4b5fd; color: var(--primary); }
        
        .btn-delete { background: transparent; color: #a78bfa; font-size: 1.2rem; padding: 0 8px; }
        .btn-delete:hover { color: var(--danger); background: #fee2e2; border-radius: 50%; }

        .retaken-row { opacity: 0.5; }
        .retaken-row td { text-decoration: line-through; text-decoration-color: #a78bfa; }
        .retaken-row .checkbox-wrapper { text-decoration: none; opacity: 1; }

        /* The Secret Footer */
        .secret-footer {
            margin-top: auto;
            color: #a78bfa;
            font-size: 0.9rem;
            text-align: center;
            padding-bottom: 20px;
        }
        
        .heart {
            display: inline-block;
            color: #c4b5fd;
            cursor: help;
            transition: transform 0.3s, color 0.3s;
            position: relative;
        }
        
        .heart:hover {
            transform: scale(1.3);
            color: #8b5cf6; /* Turns nice purple on hover */
        }

        /* Tooltip for the heart */
        .heart:hover::after {
            content: "Jana, I love you";
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: #8b5cf6;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            white-space: nowrap;
            font-size: 0.85rem;
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
            font-weight: 600;
            animation: popIn 0.3s ease;
        }
        
        @keyframes popIn {
            from { opacity: 0; transform: translateX(-50%) translateY(10px); }
            to { opacity: 1; transform: translateX(-50%) translateY(0); }
        }

    </style>
</head>
<body>

<div class="container">
    <div class="header-actions">
        <h1>CGPA Calculator</h1>
        <div>
            <button class="btn btn-row" onclick="resetAll()">Reset</button>
            <button class="btn btn-primary" onclick="loadUserCase()">Load Data</button>
        </div>
    </div>

    <div id="semesters-container"></div>

    <div style="text-align: center; margin-top: 40px; padding-bottom: 20px;">
        <button class="btn btn-primary" style="font-size: 1.1rem; padding: 15px 30px; border-radius: 30px;" onclick="addSemester()">+ Add Next Semester</button>
    </div>
</div>

<div class="secret-footer">
    Made with <span class="heart">ðŸ’œ</span> just for you
</div>

<script>
    const gradeMap = {
        'A': 4.00, 'A-': 3.67,
        'B+': 3.33, 'B': 3.00, 'B-': 2.67,
        'C+': 2.33, 'C': 2.00, 'C-': 1.67,
        'D+': 1.33, 'D': 1.00, 'F': 0.00, 'N/A': 0.00
    };

    function calculateAll() {
        let cumPoints = 0;
        let cumCredits = 0;

        const cards = document.querySelectorAll('.semester-card');

        cards.forEach(card => {
            let semPoints = 0;
            let semCredits = 0;
            
            card.querySelectorAll('tbody tr').forEach(row => {
                const cr = parseFloat(row.querySelector('.cr').value) || 0;
                const grKey = row.querySelector('.gr').value;
                const isRetaken = row.querySelector('.retake-chk').checked;
                
                // Visual styling for retaken rows
                if(isRetaken) row.classList.add('retaken-row');
                else row.classList.remove('retaken-row');

                if (grKey !== "" && cr >= 0) {
                    const pts = gradeMap[grKey];
                    const product = cr * pts;
                    
                    // ALWAYS add to Semester Totals
                    semCredits += cr;
                    semPoints += product;

                    // ONLY add to Cumulative if NOT retaken
                    if (!isRetaken) {
                        cumCredits += cr;
                        cumPoints += product;
                    }
                }
            });

            // Calculate & Display Semester Stats
            const semGPA = semCredits > 0 ? (semPoints / semCredits) : 0;
            card.querySelector('.sem-gpa').textContent = semGPA.toFixed(2);
            card.querySelector('.sem-cr').textContent = semCredits;

            // Calculate & Display Cumulative Stats
            const cgpa = cumCredits > 0 ? (cumPoints / cumCredits) : 0;
            card.querySelector('.cum-gpa').textContent = cgpa.toFixed(2);
            card.querySelector('.cum-cr').textContent = cumCredits;
        });
    }

    function addSemester(title = "") {
        const container = document.getElementById('semesters-container');
        const count = container.children.length + 1;
        
        const div = document.createElement('div');
        div.className = 'semester-card';
        div.innerHTML = `
            <div class="semester-header">
                <input type="text" class="semester-title" value="${title || 'Semester ' + count}">
                <button class="btn btn-delete" onclick="removeSemester(this)" title="Remove Semester">Ã—</button>
            </div>
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th style="width:35%">Subject</th>
                            <th style="width:12%">Credits</th>
                            <th style="width:18%">Grade</th>
                            <th style="width:20%; text-align:center;">Exclude?</th>
                            <th style="width:5%"></th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
                <button class="btn btn-row" onclick="addCourse(this)">+ Add Subject</button>
            </div>
            <div class="semester-footer">
                <div class="result-box result-sem">
                    <div class="label">Semester GPA</div>
                    <div class="main-value sem-gpa">0.00</div>
                    <div class="sub-details"><span class="sem-cr">0</span> Credits</div>
                </div>
                <div class="result-box result-cum">
                    <div class="label">Total CGPA</div>
                    <div class="main-value cum-gpa">0.00</div>
                    <div class="sub-details"><span class="cum-cr">0</span> Valid Credits</div>
                </div>
            </div>
        `;
        container.appendChild(div);
        if(!title) for(let i=0; i<3; i++) addCourse(div.querySelector('.btn-row'));
    }

    function addCourse(btn, name="", cr="", gr="", retaken=false) {
        const tbody = btn.previousElementSibling.querySelector('tbody');
        const tr = document.createElement('tr');
        
        let opts = `<option value="">-</option>`;
        for(let g in gradeMap) opts += `<option value="${g}" ${g===gr?'selected':''}>${g}</option>`;

        tr.innerHTML = `
            <td><input type="text" value="${name}" placeholder="Name"></td>
            <td><input type="number" class="cr" value="${cr}" oninput="calculateAll()" placeholder="3"></td>
            <td><select class="gr" onchange="calculateAll()">${opts}</select></td>
            <td align="center">
                <label class="checkbox-wrapper" title="Check this to exclude from CGPA (Retakes)">
                    <input type="checkbox" class="retake-chk" onchange="calculateAll()" ${retaken?'checked':''}>
                    <small>Retaken</small>
                </label>
            </td>
            <td style="text-align:center"><button class="btn btn-delete" style="font-size:1rem" onclick="removeRow(this)">Ã—</button></td>
        `;
        tbody.appendChild(tr);
        calculateAll();
    }

    function removeRow(btn) { btn.closest('tr').remove(); calculateAll(); }
    function removeSemester(btn) { if(confirm("Remove this semester?")) btn.closest('.semester-card').remove(); calculateAll(); }
    function resetAll() { document.getElementById('semesters-container').innerHTML=''; addSemester(); }

    function loadUserCase() {
        document.getElementById('semesters-container').innerHTML = '';

        // Semester 1
        addSemester("Semester 1 (Fall)");
        let s1 = document.querySelector('#semesters-container .semester-card:last-child .btn-row');
        addCourse(s1, "ENG 101", 3, "A");
        addCourse(s1, "QTM 122", 3, "A-");
        addCourse(s1, "ECO 110", 3, "B");
        addCourse(s1, "PAK 101", 2, "A");
        addCourse(s1, "ISL 101", 2, "A-");
        addCourse(s1, "MGT 111", 3, "A");
        addCourse(s1, "ISL 107", 0, "A-");

        // Semester 2
        addSemester("Spring-2025");
        let s2 = document.querySelector('#semesters-container .semester-card:last-child .btn-row');
        addCourse(s2, "ENG 102", 3, "A-");
        addCourse(s2, "SCM 101", 3, "B");
        addCourse(s2, "HSS 301", 3, "A-");
        addCourse(s2, "ACC 102", 3, "A-");
        addCourse(s2, "ECO 121 (Prev)", 3, "N/A", true); // Excluded!
        addCourse(s2, "MIS 163", 3, "A");
        addCourse(s2, "ISL 108", 0, "A");

        // Semester 3
        addSemester("Summer-2025");
        let s3 = document.querySelector('#semesters-container .semester-card:last-child .btn-row');
        addCourse(s3, "ECO 121 (New)", 3, "B+"); 
        // Semester 4 (Fall-2025) - NEW
        addSemester("Fall-2025");
        let s4 = document.querySelector('#semesters-container .semester-card:last-child .btn-row');
        addCourse(s4, "MKT 110", 3, "A");
        addCourse(s4, "ENV 120", 3, "A");
        addCourse(s4, "QTM 110", 3, "A");
        addCourse(s4, "ACC 304", 3, "A");
        addCourse(s4, "SOC 212", 3, "A-");
        addCourse(s4, "SCM 201", 3, "A-");
        addCourse(s4, "ISL 109", 0, "A-");
        calculateAll();
    }

    window.onload = function() { addSemester(); }
</script>

</body>
</html>
